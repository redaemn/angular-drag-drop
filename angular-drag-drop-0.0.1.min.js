/*
 * angular-drag-drop v0.0.1 [https://github.com/redaemn/angular-drag-drop]
 * 2014-01-10
 *
 * This software is licensed under The MIT License (MIT)
 * Copyright (c) 2014 Gabriele Rabbiosi [https://plus.google.com/+GabrieleRabbiosi/]
 * [https://github.com/redaemn/angular-drag-drop/blob/master/LICENSE]
 */

!function(a,b){var c=a.module("angular-drag-drop",["ui.bootstrap.position"]);c.directive("draggable",["$document","$parse","dragdropManager",function(c,d,e){return{restrict:"A",controller:function(){var b;this.getSetDraggableHandle=function(c){return a.isDefined(c)&&(b=c),b}},link:function(a,f,g,h){function i(a){p={pageX:a.pageX,pageY:a.pageY,top:f.css("top"),left:f.css("left")},f.css("z-index",10001),o={pageX:a.pageX,pageY:a.pageY},l(a.pageX,a.pageY),c.bind("mousemove",j),c.bind("mouseup",k),a.preventDefault()}function j(a){var b=parseInt(f.css("top"),10),c=parseInt(f.css("left"),10);f.css({top:b+(a.pageY-o.pageY)+"px",left:c+(a.pageX-o.pageX)+"px"}),o={pageX:a.pageX,pageY:a.pageY},m(a.pageX,a.pageY)}function k(d){c.unbind("mouseup",k),c.unbind("mousemove",j),a.$apply(u)?(f.css({top:p.top,left:p.left}),m(p.pageX,p.pageY),n(p.pageX,p.pageY)):n(d.pageX,d.pageY),o=b,f.css("z-index",1e4)}function l(b,c){e.dragStart(b,c,v),r(a,{pageX:b,pageY:c,draggable:q(a)}),a.$apply()}function m(b,c){e.drag(b,c,v),s(a,{pageX:b,pageY:c,draggable:q(a)}),a.$apply()}function n(b,c){t(a,{pageX:b,pageY:c,draggable:q(a)}),a.$apply(),e.dragStop(b,c,v)}var o,p,q=d(g.draggable),r=d(g.dragBegin),s=d(g.drag),t=d(g.dragStop),u=d(g.revertOnStop),v={$element:f,getModel:function(){return q(a)}},w=h.getSetDraggableHandle()||f;w.css({cursor:"move"}),f.css({"z-index":1e4}),function(){var a=f.css("position"),b=f.css("top"),c=f.css("left");(""===a||"auto"===a)&&f.css("position","relative"),""===b&&f.css("top","0px"),""===c&&f.css("left","0px")}(),w.bind("mousedown",i)}}}]),c.directive("draggableHandle",[function(){return{restrict:"A",require:"^draggable",link:function(a,b,c,d){d.getSetDraggableHandle(b)}}}]),c.directive("droppable",["$document","$parse","dragdropManager","dragdropPositioning",function(a,c,d,e){return{restrict:"A",scope:!0,link:function(a,f,g){function h(b,c){e.isMouseOver(b,c,p)&&(a.isDraggableHover=!0,d._setCurrentDroppable(p),a.$apply())}function i(c,f,g){var h=e.isMouseOver(c,f,p);h&&!a.isDraggableHover?(a.isDraggableHover=!0,d._setCurrentDroppable(p),l(a,{pageX:c,pageY:f,draggable:g.getModel(),droppable:k(a)}),a.$apply()):h&&a.isDraggableHover?(m(a,{pageX:c,pageY:f,draggable:g.getModel(),droppable:k(a)}),a.$apply()):!h&&a.isDraggableHover&&(a.isDraggableHover=!1,d._setCurrentDroppable(b),o(a,{pageX:c,pageY:f,draggable:g.getModel(),droppable:k(a)}),a.$apply())}function j(b,c,d){a.isDraggableHover&&(a.isDraggableHover=!1,n(a,{pageX:b,pageY:c,draggable:d.getModel(),droppable:k(a)}),a.$apply())}var k=c(g.droppable),l=c(g.draggableEnter),m=c(g.draggableHover),n=c(g.draggableDrop),o=c(g.draggableLeave);a.isDraggableHover=!1;var p={dragStart:h,drag:i,dragStop:j,$element:f,getModel:function(){return k(a)}};d.registerDroppable(p),f.on("$destroy",function(){d.unregisterDroppable(p)})}}}]),c.factory("dragdropManager",[function(){function c(b,c,d){k=d,a.forEach(m,function(a){a.dragStart(b,c,d)})}function d(b,c,d){a.forEach(m,function(a){a.drag(b,c,d)})}function e(c,d,e){a.forEach(m,function(a){a.dragStop(c,d,e)}),k=l=b}function f(a){var b;b=m.indexOf(a),0>b&&m.push(a)}function g(a){var b;b=m.indexOf(a),b>=0&&m.splice(b,1)}function h(){return k?k.getModel():b}function i(){return l?l.getModel():b}function j(a){l=a}var k,l,m=[];return{dragStart:c,drag:d,dragStop:e,registerDroppable:f,unregisterDroppable:g,getCurrentDraggable:h,getCurrentDroppable:i,_setCurrentDroppable:j}}]),c.factory("dragdropPositioning",["$position",function(a){function b(b,c,d){var e=a.offset(d.$element);return b>e.left&&b<e.left+e.width&&c>e.top&&c<e.top+e.height}return{isMouseOver:b}}])}(window.angular);