/*
 * angular-drag-drop v0.0.1 [https://github.com/redaemn/angular-drag-drop]
 * 2014-04-23
 *
 * This software is licensed under The MIT License (MIT)
 * Copyright (c) 2014 Gabriele Rabbiosi [https://plus.google.com/+GabrieleRabbiosi/]
 * [https://github.com/redaemn/angular-drag-drop/blob/master/LICENSE]
 */

!function(a,b){var c=a.module("angular-drag-drop",["ui.bootstrap.position"]);c.directive("draggable",["$document","$parse","dragdropManager",function(c,d,e){return{restrict:"A",controller:function(){var b;this.getSetDraggableHandle=function(c){return a.isDefined(c)&&(b=c),b}},link:function(a,f,g,h){function i(a){var b=0===a.type.indexOf("touch")?a.changedTouches[0]:a;return{x:b.pageX,y:b.pageY}}function j(a){a.preventDefault();var b=i(a);q={pageX:b.x,pageY:b.y,top:f.css("top"),left:f.css("left")},f.css("z-index",10001),p={pageX:b.x,pageY:b.y},m(b.x,b.y),c.bind("touchmove mousemove",k),c.bind("touchend mouseup",l)}function k(a){a.preventDefault();var b=parseInt(f.css("top"),10),c=parseInt(f.css("left"),10),d=i(a);f.css({top:b+(d.y-p.pageY)+"px",left:c+(d.x-p.pageX)+"px"}),p={pageX:d.x,pageY:d.y},n(d.x,d.y)}function l(d){d.preventDefault();var e=i(d);c.unbind("touchend mouseup",l),c.unbind("touchmove mousemove",k),a.$apply(v)?(f.css({top:q.top,left:q.left}),n(q.pageX,q.pageY),o(q.pageX,q.pageY)):o(e.x,e.y),p=b,f.css("z-index",1e4)}function m(b,c){e.dragStart(b,c,w),s(a,{pageX:b,pageY:c,draggable:r(a)}),a.$apply()}function n(b,c){e.drag(b,c,w),t(a,{pageX:b,pageY:c,draggable:r(a)}),a.$apply()}function o(b,c){u(a,{pageX:b,pageY:c,draggable:r(a)}),a.$apply(),e.dragStop(b,c,w)}var p,q,r=d(g.draggable),s=d(g.dragBegin),t=d(g.drag),u=d(g.dragStop),v=d(g.revertOnStop),w={$element:f,getModel:function(){return r(a)}},x=h.getSetDraggableHandle()||f;x.css({cursor:"move"}),f.css({"z-index":1e4}),function(){var a=f.css("position"),b=f.css("top"),c=f.css("left");(""===a||"auto"===a)&&f.css("position","relative"),""===b&&f.css("top","0px"),""===c&&f.css("left","0px")}(),x.bind("touchstart mousedown",j)}}}]),c.directive("draggableHandle",[function(){return{restrict:"A",require:"^draggable",link:function(a,b,c,d){d.getSetDraggableHandle(b)}}}]),c.directive("droppable",["$document","$parse","dragdropManager","dragdropPositioning",function(a,c,d,e){return{restrict:"A",scope:!0,link:function(a,f,g){function h(b,c){e.isMouseOver(b,c,p)&&(a.isDraggableHover=!0,d._setCurrentDroppable(p),a.$apply())}function i(c,f,g){var h=e.isMouseOver(c,f,p);h&&!a.isDraggableHover?(a.isDraggableHover=!0,d._setCurrentDroppable(p),l(a,{pageX:c,pageY:f,draggable:g.getModel(),droppable:k(a)}),a.$apply()):h&&a.isDraggableHover?(m(a,{pageX:c,pageY:f,draggable:g.getModel(),droppable:k(a)}),a.$apply()):!h&&a.isDraggableHover&&(a.isDraggableHover=!1,d._setCurrentDroppable(b),o(a,{pageX:c,pageY:f,draggable:g.getModel(),droppable:k(a)}),a.$apply())}function j(b,c,d){a.isDraggableHover&&(a.isDraggableHover=!1,n(a,{pageX:b,pageY:c,draggable:d.getModel(),droppable:k(a)}),a.$apply())}var k=c(g.droppable),l=c(g.draggableEnter),m=c(g.draggableHover),n=c(g.draggableDrop),o=c(g.draggableLeave);a.isDraggableHover=!1;var p={dragStart:h,drag:i,dragStop:j,$element:f,getModel:function(){return k(a)}};d.registerDroppable(p),f.on("$destroy",function(){d.unregisterDroppable(p)})}}}]),c.factory("dragdropManager",[function(){function c(b,c,d){k=d,a.forEach(m,function(a){a.dragStart(b,c,d)})}function d(b,c,d){a.forEach(m,function(a){a.drag(b,c,d)})}function e(c,d,e){a.forEach(m,function(a){a.dragStop(c,d,e)}),k=l=b}function f(a){var b;b=m.indexOf(a),0>b&&m.push(a)}function g(a){var b;b=m.indexOf(a),b>=0&&m.splice(b,1)}function h(){return k?k.getModel():b}function i(){return l?l.getModel():b}function j(a){l=a}var k,l,m=[];return{dragStart:c,drag:d,dragStop:e,registerDroppable:f,unregisterDroppable:g,getCurrentDraggable:h,getCurrentDroppable:i,_setCurrentDroppable:j}}]),c.factory("dragdropPositioning",["$position",function(a){function b(b,c,d){var e=a.offset(d.$element);return b>e.left&&b<e.left+e.width&&c>e.top&&c<e.top+e.height}return{isMouseOver:b}}])}(window.angular);