/*
 * angular-drag-drop v0.0.1 [https://github.com/redaemn/angular-drag-drop]
 * 2013-12-20
 *
 * This software is licensed under The MIT License (MIT)
 * Copyright (c) 2013 Gabriele Rabbiosi [https://plus.google.com/+GabrieleRabbiosi/]
 * [https://github.com/redaemn/angular-drag-drop/blob/master/LICENSE]
 */

angular.module("angular-drag-drop",["ui.bootstrap.position"]).factory("dragdropManager",[function(){function a(a,b,c){i=c,angular.forEach(k,function(d){d.dragStart(a,b,c)})}function b(a,b,c){angular.forEach(k,function(d){d.drag(a,b,c)})}function c(a,b,c){angular.forEach(k,function(d){d.dragStop(a,b,c)}),i=j=void 0}function d(a){var b;b=k.indexOf(a),0>b&&k.push(a)}function e(a){var b;b=k.indexOf(a),b>=0&&k.splice(b,1)}function f(){return i?i.getModel():void 0}function g(){return j?j.getModel():void 0}function h(a){j=a}var i,j,k=[];return{dragStart:a,drag:b,dragStop:c,registerDroppable:d,unregisterDroppable:e,getCurrentDraggable:f,getCurrentDroppable:g,_setCurrentDroppable:h}}]).factory("dragdropPositioning",["$position",function(a){function b(b,c,d){var e=a.offset(d.$element);return b>e.left&&b<e.left+e.width&&c>e.top&&c<e.top+e.height}return{isMouseOver:b}}]).directive("draggable",["$document","$parse","dragdropManager",function(a,b,c){return{restrict:"A",controller:function(){var a;this.getSetDraggableHandle=function(b){return angular.isDefined(b)&&(a=b),a}},link:function(d,e,f,g){function h(b){o={pageX:b.pageX,pageY:b.pageY,top:e.css("top"),left:e.css("left")},e.css("z-index",10001),n={pageX:b.pageX,pageY:b.pageY},k(b.pageX,b.pageY),a.bind("mousemove",i),a.bind("mouseup",j),b.preventDefault()}function i(a){var b=parseInt(e.css("top"),10),c=parseInt(e.css("left"),10);e.css({top:b+(a.pageY-n.pageY)+"px",left:c+(a.pageX-n.pageX)+"px"}),n={pageX:a.pageX,pageY:a.pageY},l(a.pageX,a.pageY)}function j(b){a.unbind("mouseup",j),a.unbind("mousemove",i),d.$apply(t)?(e.css({top:o.top,left:o.left}),l(o.pageX,o.pageY),m(o.pageX,o.pageY)):m(b.pageX,b.pageY),n=void 0,e.css("z-index",1e4)}function k(a,b){c.dragStart(a,b,u),q(d,{pageX:a,pageY:b,draggable:p(d)}),d.$apply()}function l(a,b){c.drag(a,b,u),r(d,{pageX:a,pageY:b,draggable:p(d)}),d.$apply()}function m(a,b){s(d,{pageX:a,pageY:b,draggable:p(d)}),d.$apply(),c.dragStop(a,b,u)}var n,o,p=b(f.draggable),q=b(f.dragBegin),r=b(f.drag),s=b(f.dragStop),t=b(f.revertOnStop),u={$element:e,getModel:function(){return p(d)}},v=g.getSetDraggableHandle()||e;v.css({cursor:"move"}),e.css({"z-index":1e4}),function(){var a=e.css("position"),b=e.css("top"),c=e.css("left");(""===a||"auto"===a)&&e.css("position","relative"),""===b&&e.css("top","0px"),""===c&&e.css("left","0px")}(),v.bind("mousedown",h)}}}]).directive("draggableHandle",[function(){return{restrict:"A",require:"^draggable",link:function(a,b,c,d){d.getSetDraggableHandle(b)}}}]).directive("droppable",["$document","$parse","dragdropManager","dragdropPositioning",function(a,b,c,d){return{restrict:"A",scope:!0,link:function(a,e,f){function g(b,e){d.isMouseOver(b,e,o)&&(a.isDraggableHover=!0,c._setCurrentDroppable(o),a.$apply())}function h(b,e,f){var g=d.isMouseOver(b,e,o);g&&!a.isDraggableHover?(a.isDraggableHover=!0,c._setCurrentDroppable(o),k(a,{pageX:b,pageY:e,draggable:f.getModel(),droppable:j(a)}),a.$apply()):g&&a.isDraggableHover?(l(a,{pageX:b,pageY:e,draggable:f.getModel(),droppable:j(a)}),a.$apply()):!g&&a.isDraggableHover&&(a.isDraggableHover=!1,c._setCurrentDroppable(void 0),n(a,{pageX:b,pageY:e,draggable:f.getModel(),droppable:j(a)}),a.$apply())}function i(b,c,d){a.isDraggableHover&&(a.isDraggableHover=!1,m(a,{pageX:b,pageY:c,draggable:d.getModel(),droppable:j(a)}),a.$apply())}var j=b(f.droppable),k=b(f.draggableEnter),l=b(f.draggableHover),m=b(f.draggableDrop),n=b(f.draggableLeave);a.isDraggableHover=!1;var o={dragStart:g,drag:h,dragStop:i,$element:e,getModel:function(){return j(a)}};c.registerDroppable(o),e.on("$destroy",function(){c.unregisterDroppable(o)})}}}]);